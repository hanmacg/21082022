---
title: "21082022 Question 4"
documentclass: elsarticle
Thesis_FP: no
output:
  html_document:
    df_print: paged
  pdf_document:
    keep_tex: yes
    template: Tex/TexDefault.txt
    fig_width: 3.5
    fig_height: 3.5
Author1: Hannah MacGinty
Ref1: Stellenbosch, South Africa
Email1: 21082022\@sun.ac.za
BottomRFooter: \footnotesize Page \thepage
addtoprule: yes
addfootrule: yes
margin: 2.3
bottom: 2
top: 2.5
HardSet_layout: yes
linenumbers: no
bibliography: Tex/ref.bib
csl: "Tex/harvard-stellenbosch-university.csl"
RemovePreprintSubmittedTo: yes
Journal: Journal of Economics
toc: no
numbersections: yes
fontsize: 11pt
linestretch: 1.2
link-citations: yes
AddTitle: yes
abstract: |
  Netflix has seen a decline in users in recent months and a sharp decline in their share price.
---

<!-- First: Set your default preferences for chunk options: -->

<!-- If you want a chunk's code to be printed, set echo = TRUE. message = FALSE stops R printing ugly package loading details in your final paper too. I also suggest setting warning = FALSE and checking for warnings in R, else you might find ugly warnings in your paper. -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos="H", fig.pos = 'H')
# Note: Include = FALSE implies the code is executed, but not printed in your pdf.
# warning and message = FALSE implies ugly messages and warnings are removed from your pdf.
# These should be picked up when you execute the command chunks (code sections below) in your rmd, not printed in your paper!

# Lets load in example data, and see how this can be stored and later called from your 'data' folder.
if(!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)
library(knitr)
library(kableExtra)

# Notice that as you are working in a .Rproj file (I am assuming you are) - the relative paths of your directories start at your specified root.
# This means that when working in a .Rproj file, you never need to use getwd() - it is assumed as your base root automatically.


```


<!-- ############################## -->
<!-- # Start Writing here: -->
<!-- ############################## -->

# Introduction \label{Introduction}

Netflix is concerned with their drop in users.

# Data  {-}

Netflix is known for having terrible options for viewers. It should keep the movies and show with the highest IMDB scores and drop those with the lowest. 

Firstly, it is important to have well reknowned actors on Netflix in order to keep viewers interested.

Actors are arranged by their average IMDb score and filtered to only include those with the top IMDb scores. From this, we can find the 17 actors with the highest IMDb scores - thus reflecting actors of the best calibre. The frequency of these top 17 actors in Netflix titles are presented in the following table.

Some of the top actors, like Anna Gunn and Betsy Brandt, only appear in one Netflix title. To maintain customers, Netflix should increase the number of titles that feature these 17 actors. Customers will not give up on their Netflix accounts if they feel Netflix can maintain prestige and present the best actors and titles. 

<!-- The following is a code chunk. It must have its own unique name (after the r), or no name. After the comma follows commands for R which are self-explanatory. By default, the code and messages will not be printed in your pdf, just the output: -->

```{r table-1, echo=TRUE, message=FALSE, warning=FALSE, results="asis"}
titles <- read_csv("data/titles.csv")
credits <- read_csv("data/credits.csv")
merged_data <- merge(titles, credits, by = "id", all.x = TRUE)

# top_10_popular <- merged_data %>%
#     filter(type == "MOVIE") %>% 
#   group_by(title) %>%
#   summarise(max_imdb_score = max(imdb_score)) %>%
#   arrange(desc(max_imdb_score)) %>%
#   top_n(10, max_imdb_score)



# top_10_popular_actor <- merged_data %>%
#   filter(role == "ACTOR") %>% 
#   group_by(name) %>%
#   summarise(max_imdb_score = max(imdb_score)) %>%
#   arrange(desc(max_imdb_score)) %>%
#   top_n(10, max_imdb_score)
# 
# 
# actor_frequency <- merged_data %>%
#   filter(role == "ACTOR") %>%
#   filter(name %in% top_10_popular_actor$name) %>%
#   count(name) %>% 
#   rename (Actor = name, Frequency = n)

source("code/calculate_actor_frequency.R")
actor_frequency <- calculate_actor_frequency(merged_data)

table <- kable(actor_frequency, row.names = TRUE,
      caption = 'Top Actors on Netflix by IMDB Score and their Frequency in Netflix titles',
      format = "html", booktabs = T) %>%
        kable_styling(full_width = T,
                      latex_options = c("striped",
                                        "scale_down",
                                        "HOLD_position"),
                      font_size = 13)
table


#plot average IMDB scores for movies with certain actors over time

# categories <- unique(merged_data$type)
# 
# ggplot(merged_data, aes(x = type)) +
#   geom_bar() +
#   xlab("Type") +
#   ylab("Count") +
#   ggtitle("Count of Movies versus Series")


# selected_movies <- c("C/o Kancharapalem", "Chhota Bheem & Krishna in Mayanagari", "David Attenborough: A Life on Our Planet",
#                      "No Longer Kids", "Forrest Gump", "Inception", "Sky Tour: The Movie", "A Lion in the House",
#                      "Anbe Sivam", "Bo Burnham: Inside", "Bye Bye London", "Rubaru Roshni")
# 
# filtered_data <- merged_data[merged_data$title %in% selected_movies, ]

# ggplot(filtered_data, aes(x = runtime)) +
#   geom_histogram(binwidth = 10, fill = "steelblue", color = "white") +
#   xlab("Runtime") +
#   ylab("Count") +
#   ggtitle("Distribution of Movie Runtimes for Selected Movies")


#run time for movies
# movie <- merged_data %>% filter(type == "MOVIE") %>%
# ggplot(aes(x = runtime)) +
#   geom_histogram(binwidth = 10, fill = "steelblue", color = "white") +
#   xlab("Runtime") +
#   ylab("Count") +
#   ggtitle("Distribution of Movie Runtimes") + theme_light()
# 
# 
# movie


#run time for series

# series <- merged_data %>% filter(type == "SHOW") %>%
# ggplot(aes(x = runtime)) +
#   geom_histogram(binwidth = 10, fill = "steelblue", color = "white") +
#   xlab("Runtime") +
#   ylab("Count") +
#   ggtitle("Distribution of Series Runtimes") + theme_light()
# 
# series



# correlation <- merged_data %>% filter(type =="MOVIE") %>% 
#   select(imdb_score, runtime) %>% 
#   drop_na() %>% 
#   cor()
# 
# cor_df <- as.data.frame(correlation)
# 
# cor_df <- cor_df %>% 
#   rownames_to_column("IMDb_Score") %>% 
#   melt(id.vars = "IMDb_Score", variable.name = "Runtime", value.name = "Correlation")
# 
# ggplot(cor_df, aes(x = Runtime, y = IMDb_Score, fill = Correlation)) +
#   geom_tile(color = "white") +
#   scale_fill_gradient(low = "white", high = "steelblue") +
#   xlab("Runtime") +
#   ylab("IMDb Score") +
#   ggtitle("Correlation Heatmap: IMDb Score vs. Runtime of Movies")


# average_imdb <- genres %>%
#     filter(genres != "") %>%
#   group_by(genres) %>%
#   summarize(average_imdb_score = mean(imdb_score, na.rm = TRUE))
# 
# 
# ggplot(average_imdb, aes(x = genres, y = average_imdb_score)) +
#   geom_bar(stat = "identity", fill = "red") +
#   xlab("Genres") +
#   ylab("Average IMDb Score") +
#   ggtitle("Average IMDb Score by Genres") + theme_light() +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

By averaging popularity (from TMDb score) by genre, it can be seen that Sci-fi is the most popular genre, followed by horror. To keep viewers interested in Netflix, it is worth increasing the number of movies and shows in these categories to ensure customers are not lost. Since documentaries and reality, on average, have low popularity, it is worth considering cutting down on these genres which are plentiful on Netflix. 

```{r}

# genres <- merged_data %>%
#   separate_rows(genres, sep = ", ") %>%
#   mutate(genres = str_remove_all(genres, "\\[|\\]"),  
#          genres = str_trim(genres))  
# 
# average_tmdb <- genres %>%
#     filter(genres != "") %>%
#   group_by(genres) %>%
#   summarize(average_popularity = mean(tmdb_popularity, na.rm = TRUE))

source("code/genre_plot.R")
genre <- genre_plot(merged_data)

# genre_plot <- merged_data %>% separate_rows(genres, sep = ", ") %>%
#   mutate(genres = str_remove_all(genres, "\\[|\\]"),  
#          genres = str_trim(genres)) %>% filter(genres != "") %>%
#   group_by(genres) %>%
#   summarize(average_popularity = mean(tmdb_popularity, na.rm = TRUE)) %>%   ggplot(aes(x = genres, y = average_popularity)) +
#   geom_bar(stat = "identity", fill = "red") +
#   xlab("Genres") +
#   ylab("Average TMDb Poopularity") +
#   ggtitle("Average TMDb Popularity by Genres") + theme_light() +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1))

# ggplot(average_tmdb, aes(x = genres, y = average_popularity)) +
#   geom_bar(stat = "identity", fill = "red") +
#   xlab("Genres") +
#   ylab("Average TMDb Poopularity") +
#   ggtitle("Average TMDb Popularity by Genres") + theme_light() +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1))




```

By filtering the data to include the most popular movies, based on the TMDb popularity score of above 100, it is shown that the most popular movies typically have a run time around 100 minutes. Nextflix should thus aim to have movie runtimes that are approximately this long. Movies shorter or substantially longer tend to be less popular. 

Similarly, the most popular series have a run time around 40 minutes. None of the most popular series are longer than 70 minutes. 


```{r Figure2, warning =  FALSE, fig.align = 'center', fig.cap = "Caption Here \\label{Figure2}", fig.height = 3, fig.width = 6, dev = 'png'}


# dist <- merged_data %>%  filter(tmdb_popularity >= 100) %>% filter(type == "MOVIE") %>%
# ggplot(aes(x = runtime)) +
#   geom_histogram(binwidth = 10, fill = "red", color = "white") +
#   xlab("Runtime") +
#   ylab("Count") +
#   ggtitle("Distribution of Most Popular Movie's Runtimes") + theme_light()


# 
# filtered_data <- merged_data %>%
#   filter(type == "MOVIE") %>%
#   filter(tmdb_popularity >= 100)
# 
# averaged_popularity <- filtered_data %>%
#   group_by(title) %>%
#   summarize(average_popularity = mean(tmdb_popularity, na.rm = TRUE))
# 
# dist <- filtered_data %>% group_by(title) %>% 
#   ggplot(aes(x = runtime)) +
#   geom_histogram(binwidth = 10, fill = "red", color = "white") +
#   xlab("Runtime") +
#   ylab("Count") +
#   ggtitle("Distribution of Most Popular Movie's Runtimes") +
#   theme_light()



source("code/plot_runtime_distribution.R")
dist_movie <- plot_runtime_distribution(merged_data, "MOVIE")
dist_movie

# filtered_data <- merged_data %>%
#   filter(type == "MOVIE") %>%
#   filter(tmdb_popularity >= 100) %>%
#   distinct(title, .keep_all = TRUE)
# 
# dist <- filtered_data %>%
#   ggplot(aes(x = runtime)) +
#   geom_histogram(binwidth = 10, fill = "red", color = "white") +
#   xlab("Runtime") +
#   ylab("Count") +
#   ggtitle("Distribution of Most Popular Movie's Runtimes") +
#   theme_light()
# 
# print(dist)


#For series
# filtered_data_show <- merged_data %>%
#   filter(type == "SHOW") %>%
#   filter(tmdb_popularity >= 100) %>%
#   distinct(title, .keep_all = TRUE)
# 
# dist_show <- filtered_data_show %>%
#   ggplot(aes(x = runtime)) +
#   geom_histogram(binwidth = 10, fill = "red", color = "white") +
#   xlab("Runtime") +
#   ylab("Count") +
#   ggtitle("Distribution of Most Popular Series' Runtimes") +
#   theme_light()
# 
# print(dist_show)

dist_series <- plot_runtime_distribution(merged_data, "SHOW")



```

 

<!-- :::::: {.columns data-latex="[T]"} -->
<!-- ::: {.column data-latex="{0.7\textwidth}"} -->
<!-- ```{r, echo=FALSE, fig.width=4, fig.height=4} -->
<!-- par(mar = c(4, 4, .2, .1)) -->
<!-- plot(cars, pch = 19) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: {.column data-latex="{0.05\textwidth}"} -->
<!-- \ -->
<!-- ::: -->
<!-- ::: {.column data-latex="{0.2\textwidth}"} -->
<!-- \scriptsize -->

<!-- ## Data {-} -->
<!-- The figure on the left-hand side shows the `cars` data. -->

<!-- Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do -->
<!-- eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut -->
<!-- enim ad minim veniam, quis nostrud exercitation ullamco laboris -->
<!-- nisi ut aliquip ex ea commodo consequat. -->
<!-- ::: -->
<!-- :::::: -->





<!-- $$ -->
<!-- This is a commented out section in the writing part. -->
<!-- Comments are created by highlighting text, amnd pressing CTL+C -->
<!-- \\begin{align} -->
<!-- \\beta = \\alpha^2 -->
<!-- \end{align} -->
<!-- $$ -->


\hfill

<!-- hfill can be used to create a space, like here between text and table. -->


# Conclusion

Overall, there are a number of steps Netflix can take to address its decline in viewers. It should include more movies and shows with the best actors according to IMDb scores, include more sh0ws with the most popular genres, such as Sci-fi, and ensure that series and movies are the appropriate and optimal length to keep viwers interested. 

<!-- Make title of bibliography here: -->
<!-- \newpage -->

\newpage

